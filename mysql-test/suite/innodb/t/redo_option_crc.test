--source include/have_innodb.inc
--source include/have_debug.inc

call mtr.add_suppression("Page checksum stored in redo log record \\d+ does not match counted checksum \\d+ for page");

# Disable pages flushing to allow redo log records to be executed on --prepare.
SET GLOBAL debug_dbug="+d,ib_log_checkpoint_avoid";
SET GLOBAL innodb_page_cleaner_disabled_debug=ON;
SET GLOBAL innodb_redo_log_checksum=ON;
SET GLOBAL innodb_flush_log_at_trx_commit=1;
CREATE TABLE t1(i INT) ENGINE INNODB;
INSERT INTO t1 VALUES (1);
--source include/kill_mysqld.inc
--source include/start_mysqld.inc
--let SEARCH_FILE=$MYSQLTEST_VARDIR/log/mysqld.1.err
--let SEARCH_PATTERN=Page checksum stored in redo log record
--source include/search_pattern_in_file.inc

SET GLOBAL debug_dbug="+d,ib_log_checkpoint_avoid";
SET GLOBAL innodb_page_cleaner_disabled_debug=ON;
SET GLOBAL innodb_redo_log_checksum=ON;
SET GLOBAL innodb_flush_log_at_trx_commit=1;
SET GLOBAL debug_dbug="+d,ib_log_corrupt_option_crc";
INSERT INTO t1 VALUES (2);
--source include/kill_mysqld.inc
--source include/start_mysqld.inc
--let SEARCH_FILE=$MYSQLTEST_VARDIR/log/mysqld.1.err
--let SEARCH_PATTERN=Page checksum stored in redo log record
--source include/search_pattern_in_file.inc

DROP TABLE t1;
